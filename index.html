<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAMA Sales Tool 2025: Premium Saver 11/3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f3f4f6; }
        .ttb-blue { color: #002d63; }
        .ttb-bg-blue { background-color: #002d63; }
        .ttb-orange { color: #f05a22; }
        .ttb-bg-orange { background-color: #f05a22; }
        .gradient-card { background: linear-gradient(135deg, #002d63 0%, #005099 100%); }
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="ttb-bg-blue text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="font-bold text-xl tracking-wide">MAMA <span class="text-orange-400">2025</span></span>
                    <span class="ml-4 text-sm bg-white/10 px-2 py-1 rounded hidden sm:block">Premium Saver 11/3 Simulator</span>
                </div>
                <div class="text-xs text-gray-300">Updated: Apr 2025</div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
        
        <!-- Input Section -->
        <div class="bg-white rounded-2xl shadow-md p-6 mb-8 border-l-4 border-orange-500">
            <h2 class="text-xl font-bold ttb-blue mb-4 flex items-center">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                กำหนดข้อมูลการลงทุน
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <!-- Premium Input -->
                <div class="col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">เบี้ยประกันภัยรายปี (บาท)</label>
                    <div class="relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">฿</span>
                        </div>
                        <input type="number" id="premiumInput" value="1000000" class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-7 pr-12 py-3 sm:text-lg border-gray-300 rounded-md bg-gray-50" placeholder="0.00">
                    </div>
                    <p class="mt-1 text-xs text-gray-500">*ชำระเบี้ย 3 ปี คุ้มครอง 11 ปี</p>
                </div>

                <!-- Deposit Logic -->
                <div class="col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">สิทธิ์เงินฝากดอกเบี้ยพิเศษ (เท่า)</label>
                    <select id="multiplierInput" class="focus:ring-blue-500 focus:border-blue-500 block w-full py-3 px-3 sm:text-lg border-gray-300 rounded-md bg-gray-50">
                        <option value="1">1 เท่า</option>
                        <option value="5">5 เท่า</option>
                        <option value="10" selected>10 เท่า (แนะนำ)</option>
                        <option value="15">15 เท่า</option>
                    </select>
                    <p class="mt-1 text-xs ttb-orange" id="depositAmountDisplay">วงเงินฝาก: 10,000,000 บาท</p>
                </div>

                <!-- Interest Rate -->
                <div class="col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">อัตราดอกเบี้ยพิเศษ (% ต่อปี)</label>
                    <input type="number" id="interestRateInput" value="1.5" step="0.1" class="focus:ring-blue-500 focus:border-blue-500 block w-full px-3 py-3 sm:text-lg border-gray-300 rounded-md bg-gray-50">
                    <p class="mt-1 text-xs text-green-600">ดอกเบี้ยปกติเปรียบเทียบ: 0.25%</p>
                </div>
            </div>
            
            <div class="mt-6 flex justify-end">
                <button onclick="calculate()" class="ttb-bg-orange hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-lg shadow transition duration-300 transform hover:scale-105 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 3.666V14m-6.857 0h2.857C12 14 13 14 13 11.5v-3.5C13 6 12 5 9 5H7.571a1 1 0 00-.992.883L6.5 7m7.5 13.5h2.5M6.5 20.5h2.5M12 17.5v-3.5"></path></svg>
                    คำนวณผลตอบแทน
                </button>
            </div>
        </div>

        <!-- Dashboard Result -->
        <div id="resultSection" class="hidden fade-in">
            <!-- Highlight Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <!-- Total Benefit -->
                <div class="bg-white rounded-xl shadow p-5 border-t-4 border-green-500">
                    <div class="text-sm text-gray-500">ผลตอบแทนสุทธิรวม (11 ปี)</div>
                    <div class="text-2xl font-bold text-green-600 mt-1" id="totalNetBenefit">0</div>
                    <div class="text-xs text-gray-400 mt-2">ประกัน + ดอกเบี้ยสุทธิ</div>
                </div>
                
                <!-- Insurance Profit -->
                <div class="bg-white rounded-xl shadow p-5 border-t-4 border-blue-500">
                    <div class="text-sm text-gray-500">กำไรจากส่วนประกันฯ</div>
                    <div class="text-2xl font-bold ttb-blue mt-1" id="insProfit">0</div>
                    <div class="text-xs text-gray-400 mt-2">IRR: <span id="insIRR">0%</span></div>
                </div>

                <!-- Deposit Interest -->
                <div class="bg-white rounded-xl shadow p-5 border-t-4 border-orange-500">
                    <div class="text-sm text-gray-500">ดอกเบี้ยรับสุทธิ (ต่อปี)</div>
                    <div class="text-2xl font-bold ttb-orange mt-1" id="depInterestYearly">0</div>
                    <div class="text-xs text-gray-400 mt-2">หลังหักภาษี 15%</div>
                </div>

                <!-- Comparison -->
                <div class="gradient-card rounded-xl shadow p-5 text-white">
                    <div class="text-sm opacity-80">ชนะเงินฝากทั่วไป</div>
                    <div class="text-3xl font-bold mt-1" id="compareGain">0</div>
                    <div class="text-xs opacity-80 mt-2">บาท (โดยประมาณ)</div>
                </div>
            </div>

            <!-- Main Content: Chart & Table -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- Left: Insurance Flow Table -->
                <div class="lg:col-span-2 bg-white rounded-2xl shadow-md overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-100 bg-gray-50 flex justify-between items-center">
                        <h3 class="font-bold ttb-blue text-lg">ตารางกระแสเงินสด (Premium Saver 11/3)</h3>
                        <span class="text-xs font-semibold px-2 py-1 bg-blue-100 text-blue-800 rounded">ความคุ้มครองชีวิตเริ่มต้น <span id="sumAssuredDisplay">0</span></span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-center">
                            <thead class="bg-gray-100 text-gray-600 font-semibold">
                                <tr>
                                    <th class="py-3 px-2">สิ้นปีกรมธรรม์</th>
                                    <th class="py-3 px-2 text-red-500">เบี้ยที่ชำระ</th>
                                    <th class="py-3 px-2 text-green-600">เงินคืนระหว่างสัญญา</th>
                                    <th class="py-3 px-2 text-blue-600">เงินครบสัญญา</th>
                                    <th class="py-3 px-2">กระแสเงินสดสุทธิ</th>
                                </tr>
                            </thead>
                            <tbody id="cashflowTable" class="divide-y divide-gray-100">
                                <!-- JS Generated -->
                            </tbody>
                            <tfoot class="bg-blue-50 font-bold">
                                <tr>
                                    <td class="py-3">รวม</td>
                                    <td class="text-red-500" id="sumPremium">0</td>
                                    <td class="text-green-600" id="sumCashback">0</td>
                                    <td class="text-blue-600" id="sumMaturity">0</td>
                                    <td class="ttb-blue" id="sumNet">0</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>

                <!-- Right: Deposit & Graph -->
                <div class="lg:col-span-1 flex flex-col gap-6">
                    
                    <!-- Graph -->
                    <div class="bg-white rounded-2xl shadow-md p-6">
                        <h3 class="font-bold text-gray-700 mb-4 text-center">เปรียบเทียบผลประโยชน์สะสม</h3>
                        <canvas id="benefitChart" height="250"></canvas>
                    </div>

                    <!-- Deposit Summary Box -->
                    <div class="bg-orange-50 rounded-2xl p-6 border border-orange-200">
                        <h3 class="font-bold ttb-orange mb-3">สรุปส่วนเงินฝาก (Multiplier)</h3>
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">เงินต้นฝาก:</span>
                                <span class="font-bold text-gray-800" id="depPrincipal">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ดอกเบี้ยพิเศษ (Gross):</span>
                                <span class="font-bold text-gray-800" id="depGross">0</span>
                            </div>
                            <div class="flex justify-between border-b border-orange-200 pb-2">
                                <span class="text-gray-600">ภาษี (15%):</span>
                                <span class="font-bold text-red-500" id="depTax">0</span>
                            </div>
                            <div class="flex justify-between pt-1">
                                <span class="font-bold ttb-blue">ดอกเบี้ยรับสุทธิ:</span>
                                <span class="font-bold ttb-blue text-lg" id="depNetTotal">0</span>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Script -->
    <script>
        // Utilities
        const formatMoney = (num) => {
            return num.toFixed(0).replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,');
        }

        const parseInput = (id) => parseFloat(document.getElementById(id).value.replace(/,/g, '')) || 0;

        // Dynamic Deposit Amount Update
        document.getElementById('premiumInput').addEventListener('input', updateDepositDisplay);
        document.getElementById('multiplierInput').addEventListener('change', updateDepositDisplay);

        function updateDepositDisplay() {
            const prem = parseInput('premiumInput');
            const mult = parseInput('multiplierInput');
            document.getElementById('depositAmountDisplay').innerText = `วงเงินฝาก: ${formatMoney(prem * mult)} บาท`;
        }

        // Logic Calculation
        let myChart = null;

        function calculate() {
            // 1. Get Inputs
            const premium = parseInput('premiumInput');
            const multiplier = parseInput('multiplierInput');
            const interestRate = parseInput('interestRateInput');
            
            // Constants based on Product (11/3) & Logic provided
            const term = 11;
            const payTerm = 3;
            const cashbackRate = 0.01; // 1% of Annual Premium (based on CSV logic)
            const maturityRate = 3.495; // 349.5% of Annual Premium
            const taxRate = 0.15;
            
            // Deposit Calc
            const depositPrincipal = premium * multiplier;
            const depInterestGross = depositPrincipal * (interestRate / 100);
            const depTax = depInterestGross * taxRate;
            const depInterestNet = depInterestGross - depTax;
            
            // Insurance Calc
            let totalPremium = 0;
            let totalCashback = 0;
            let maturityBenefit = 0;
            let tableHTML = '';
            let cashFlows = []; // For IRR
            let accumulatedBenefit = [];

            // Year 0 (Initial)
            cashFlows.push(-premium); 

            for (let year = 1; year <= term; year++) {
                let premPaid = (year <= payTerm) ? premium : 0;
                totalPremium += premPaid;

                // Cashback logic: Year 2, 4, 6, 8, 10
                let cb = 0;
                if ([2, 4, 6, 8, 10].includes(year)) {
                    cb = premium * cashbackRate; // 1% of Premium
                }
                totalCashback += cb;

                // Maturity logic: Year 11
                let mat = 0;
                if (year === term) {
                    mat = premium * maturityRate;
                }
                maturityBenefit += mat;

                let netFlow = cb + mat - premPaid;
                
                // Add to IRR stream (Simplified for yearly)
                if(year <= payTerm) {
                    // Paying premium usually happens at start of year, benefits at end. 
                    // To simplify for this view, we treat net flow.
                    // Precise IRR requires dates, but here we use approximation.
                }

                tableHTML += `
                    <tr class="hover:bg-gray-50 transition">
                        <td class="py-3 text-gray-500">${year}</td>
                        <td class="text-red-500 font-medium">${premPaid > 0 ? '-' + formatMoney(premPaid) : '-'}</td>
                        <td class="text-green-600">${cb > 0 ? '+' + formatMoney(cb) : '-'}</td>
                        <td class="text-blue-600 font-bold">${mat > 0 ? '+' + formatMoney(mat) : '-'}</td>
                        <td class="font-bold ${netFlow >= 0 ? 'text-green-700' : 'text-red-500'}">${formatMoney(netFlow)}</td>
                    </tr>
                `;
            }

            // Calculations Summaries
            const totalInsBenefit = totalCashback + maturityBenefit;
            const insNetProfit = totalInsBenefit - totalPremium;
            const totalDepInterestNet = depInterestNet * 1; // Assuming 1 year calculation for comparison or multiplied by years if TD
            // Note: The CSV shows simple annual interest comparison. We will show Annual Interest.

            // Render DOM
            document.getElementById('resultSection').classList.remove('hidden');
            
            // Cards
            document.getElementById('insProfit').innerText = '+' + formatMoney(insNetProfit);
            document.getElementById('depInterestYearly').innerText = '+' + formatMoney(depInterestNet);
            document.getElementById('totalNetBenefit').innerText = formatMoney(insNetProfit + (depInterestNet * 11)); // Assuming deposit stays for 11 years? Or just showing potential? 
            // Better logic: Show Ins Profit + 1 Year Deposit Interest as immediate impact, or customizable duration. 
            // Let's stick to CSV logic: Total Return = Ins Profit + (Annual Net Interest * Years?) 
            // The CSV compares "Average per year". Let's show Total Net Benefit of Insurance + 1 Year Deposit for simplicity/impact.
            // *Correction*: Let's show Total Insurance Net + Total Deposit Net (assuming 1 year special rate).
            document.getElementById('totalNetBenefit').innerText = formatMoney(insNetProfit + depInterestNet); 

            // Compare with Normal Saving (0.25%)
            const normalInterest = depositPrincipal * 0.0025; // No tax usually for first 20k, but let's assume simple
            const gain = (depInterestNet) - normalInterest;
            document.getElementById('compareGain').innerText = '+' + formatMoney(gain);

            // Table Footer
            document.getElementById('sumPremium').innerText = '-' + formatMoney(totalPremium);
            document.getElementById('sumCashback').innerText = formatMoney(totalCashback);
            document.getElementById('sumMaturity').innerText = formatMoney(maturityBenefit);
            document.getElementById('sumNet').innerText = formatMoney(insNetProfit);
            document.getElementById('cashflowTable').innerHTML = tableHTML;
            document.getElementById('sumAssuredDisplay').innerText = formatMoney(premium * 10); // Typically 10x Premium

            // IRR Approximation (Simple Formula)
            const insIRRVal = 1.69; // Hardcoded based on CSV "1.695%" for stability, or implement Newton-Raphson
            document.getElementById('insIRR').innerText = insIRRVal + '%';

            // Deposit Section
            document.getElementById('depPrincipal').innerText = formatMoney(depositPrincipal);
            document.getElementById('depGross').innerText = formatMoney(depInterestGross);
            document.getElementById('depTax').innerText = '-' + formatMoney(depTax);
            document.getElementById('depNetTotal').innerText = formatMoney(depInterestNet);

            // Chart
            renderChart(totalPremium, totalInsBenefit, depositPrincipal, depInterestNet);
            
            // Scroll to result
            document.getElementById('resultSection').scrollIntoView({behavior: 'smooth'});
        }

        function renderChart(premium, benefit, depPrinc, depInt) {
            const ctx = document.getElementById('benefitChart').getContext('2d');
            
            if (myChart) myChart.destroy();

            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['เงินต้นที่จ่าย/ฝาก', 'ผลประโยชน์ที่ได้รับ'],
                    datasets: [
                        {
                            label: 'ประกัน (Premium Saver)',
                            data: [premium, benefit],
                            backgroundColor: '#002d63',
                            borderRadius: 6
                        },
                        {
                            label: 'ดอกเบี้ยเงินฝาก (สุทธิ 1 ปี)',
                            data: [depPrinc, depPrinc + depInt], // Show growth
                            backgroundColor: '#f05a22',
                            borderRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatMoney(context.raw) + ' บ.';
                                }
                            }
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, ticks: { callback: function(value) { return value / 1000000 + 'M'; } } }
                    }
                }
            });
        }

        // Initialize with default
        updateDepositDisplay();
    </script>
</body>
</html>
