<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Link Hub ‚Äî Prototype</title>
<style>
  :root{
    --primary:#0b4a6f; --muted:#667; --card:#fff; --bg:#f4f7fb;
  }
  body{font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai UI", "Sarabun", Arial; background:var(--bg); margin:0; color:#111;}
  header.cover{background:linear-gradient(90deg, rgba(11,74,111,0.9), rgba(6,94,122,0.8)), url('') center/cover no-repeat; padding:40px 20px; color:#fff;}
  .container{max-width:1100px; margin:18px auto; padding:0 16px;}
  .cover-inner{display:flex; gap:16px; align-items:center;}
  .avatar{width:96px;height:96px;border-radius:50%;background:#fff;border:4px solid rgba(255,255,255,0.25); display:flex;align-items:center;justify-content:center;font-weight:700}
  h1{margin:0;font-size:1.5rem}
  p.lead{margin:6px 0 0 0; opacity:.95}
  .cta{margin-left:auto}
  button, input[type="button"]{background:var(--primary);color:#fff;border:0;padding:8px 12px;border-radius:6px;cursor:pointer}
  .grid{display:grid; grid-template-columns: 1fr 320px; gap:18px; margin-top:18px;}
  .card{background:var(--card); padding:12px; border-radius:10px; box-shadow:0 1px 6px rgba(20,20,20,0.06)}
  .tiles{display:grid; grid-template-columns: repeat(auto-fill,minmax(140px,1fr)); gap:12px}
  .tile{display:flex; gap:8px; padding:8px; align-items:center; border-radius:8px; background:#f9fbfd; cursor:pointer}
  .tile img{width:44px;height:44px;border-radius:8px;object-fit:cover}
  .tile .meta{flex:1}
  .tile .meta small{display:block; color:var(--muted); font-size:12px}
  .feed .post{margin-bottom:12px; border-radius:8px; overflow:hidden}
  .post .post-header{display:flex; gap:10px; align-items:center; padding:10px; background:#fff}
  .post .post-body{padding:12px; background:#fff; border-top:1px solid #eee}
  .post .reactions{display:flex; gap:10px; padding:8px; align-items:center}
  .reaction-btn{cursor:pointer; background:transparent; border:0; font-size:18px}
  .small{font-size:12px; color:var(--muted)}
  .zone-tag{background:#eef7fb;color:var(--primary);padding:4px 8px;border-radius:6px;font-weight:600}
  .topbar{display:flex; gap:10px; align-items:center; justify-content:flex-end}
  .admin-badge{background:#ffd; color:#a50; padding:6px 8px; border-radius:8px; font-weight:700}
  nav.admin-nav{display:flex; gap:8px; margin-bottom:14px}
  .hidden{display:none}
  label.block{display:block;margin-top:8px}
  input[type=text], input[type=password], select, textarea {width:100%; padding:8px;border-radius:6px;border:1px solid #ddd;margin-top:6px}
  textarea{min-height:90px; resize:vertical}
  .flex{display:flex; gap:8px; align-items:center}
  .list{display:flex;flex-direction:column; gap:8px}
  .small-muted{font-size:12px;color:#666}
  .top-actions{display:flex; gap:8px; align-items:center}
  .drag-handle{cursor:grab; padding:6px}
  .image-preview{max-width:100%; height:auto; display:block; margin-top:8px}
  footer{max-width:1100px;margin:18px auto;color:#666;font-size:13px}
  @media(max-width:880px){ .grid{grid-template-columns:1fr} .cover-inner{flex-direction:column; align-items:flex-start} .cta{margin-left:0}}
</style>
</head>
<body>

<!-- LANDING -->
<header class="cover" id="landingHeader" style="background:linear-gradient(90deg,#0b4a6f,#06887a); color:#fff;">
  <div class="container">
    <div class="cover-inner">
      <div style="display:flex;gap:12px;align-items:center">
        <div class="avatar" id="landingAvatar">LH</div>
        <div>
          <h1 id="siteTitle">Link Hub ‚Äî ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏à</h1>
          <p class="lead" id="siteDesc">‡∏£‡∏ß‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÅ‡∏•‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏ã‡∏ô‡∏ï‡πà‡∏≤‡∏á ‡πÜ</p>
        </div>
      </div>
      <div class="cta">
        <div class="top-actions">
          <button id="enterBtn">Enter</button>
          <button id="adminShortcut" class="hidden">Admin</button>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- MAIN -->
<main class="container" id="app" style="display:none">
  <div class="topbar" id="topbar">
    <div id="navAdminLinks" class="hidden admin-badge">Admin</div>
    <div id="userInfo"></div>
    <div style="margin-left:auto" class="flex">
      <button id="goLanding">Back</button>
      <button id="logoutBtn" class="hidden">Logout</button>
    </div>
  </div>

  <div id="views">
    <!-- HUB VIEW -->
    <section id="hubView">
      <div class="card">
        <div style="display:flex; align-items:center; gap:12px">
          <div class="avatar" id="hubAvatar">LH</div>
          <div>
            <h2 id="hubName">Link Hub ‚Äî ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏à</h2>
            <div class="small-muted" id="hubShort">Short description ‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏à</div>
          </div>
          <div style="margin-left:auto" id="hubActions"></div>
        </div>
      </div>

      <div class="grid">
        <div>
          <div class="card">
            <h3>‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</h3>
            <div style="display:flex; justify-content:space-between; align-items:center">
              <div class="small-muted">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå (‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà)</div>
              <div>
                <button id="btnAddTile" class="hidden">+ Add tile</button>
              </div>
            </div>
            <div id="tilesWrap" class="tiles" style="margin-top:12px"></div>
          </div>

          <div class="card feed" style="margin-top:14px">
            <h3>‡πÇ‡∏û‡∏™‡∏ï‡πå</h3>

            <!-- Post composer -->
            <div id="postComposer" class="card" style="margin-bottom:12px">
              <label class="block">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
              <select id="postType"><option value="ttb">ttb</option><option value="PRU">PRU</option></select>
              <label class="block">Zone</label>
              <select id="postZone">
                <option>‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ</option><option>‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£</option><option>‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏≤‡∏ô‡∏µ</option><option>‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà</option><option>‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï</option>
              </select>
              <label class="block">‡∏ä‡∏∑‡πà‡∏≠ (‡∏ô‡∏≤‡∏°‡πÅ‡∏ù‡∏á)</label>
              <input id="postName" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÇ‡∏û‡∏™‡∏ï‡πå">
              <label class="block">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label>
              <textarea id="postContent" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..."></textarea>
              <label class="block">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ (optional)</label>
              <input id="postImage" type="file" accept="image/*">
              <img id="postImagePreview" class="image-preview hidden">
              <div style="margin-top:8px; display:flex; gap:8px; align-items:center">
                <label><input id="humanCheck" type="checkbox"> ‡∏â‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ö‡∏≠‡∏ó (simple CAPTCHA)</label>
                <button id="btnPost">Post</button>
                <small class="small-muted" id="rateInfo"></small>
              </div>
              <div class="small-muted" style="margin-top:8px">‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô: ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó, Zone, ‡∏ä‡∏∑‡πà‡∏≠, ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</div>
            </div>

            <div id="feedList"></div>
          </div>
        </div>

        <aside>
          <div class="card">
            <h4>Pinned / Quick</h4>
            <div id="pinnedLinks" style="display:flex;flex-direction:column;gap:8px"></div>
          </div>

          <div class="card" style="margin-top:12px">
            <h4>Quick Stats</h4>
            <div id="quickStats" class="list"></div>
          </div>
        </aside>
      </div>
    </section>

    <!-- ADMIN VIEWS -->
    <section id="adminView" class="hidden">
      <nav class="card admin-nav">
        <button data-admin-route="dashboard" class="admin-route">Dashboard</button>
        <button data-admin-route="menus" class="admin-route">Menus</button>
        <button data-admin-route="posts" class="admin-route">Posts</button>
        <button data-admin-route="media" class="admin-route">Media</button>
        <button data-admin-route="settings" class="admin-route">Settings</button>
        <button id="adminLogout">Logout Admin</button>
      </nav>

      <div id="adminContent" class="card"></div>
    </section>
  </div>
</main>

<!-- ADMIN LOGIN MODAL / PAGE -->
<div id="adminLoginModal" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.4); display:flex; align-items:center; justify-content:center;">
  <div class="card" style="width:420px; padding:16px;">
    <h3>Admin Login</h3>
    <label class="block">Email / Username</label>
    <input id="adminUser" type="text">
    <label class="block">Password</label>
    <input id="adminPass" type="password">
    <label style="margin-top:8px"><input id="adminRemember" type="checkbox"> ‡∏à‡∏≥‡∏â‡∏±‡∏ô‡πÑ‡∏ß‡πâ</label>
    <div style="display:flex; gap:8px; margin-top:12px;">
      <button id="btnAdminLogin">Login</button>
      <button id="btnAdminLoginCancel">Cancel</button>
    </div>
    <div id="adminLoginMsg" class="small-muted" style="margin-top:10px"></div>
  </div>
</div>

<!-- ENTRY PASSWORD MODAL -->
<div id="entryModal" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.4); display:flex; align-items:center; justify-content:center;">
  <div class="card" style="width:420px; padding:16px;">
    <h3>Protected Entry ‚Äî ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™</h3>
    <label class="block">Password</label>
    <input id="entryPassword" type="password">
    <div style="display:flex; gap:8px; margin-top:12px;">
      <button id="btnEntryOk">Enter</button>
      <button id="btnEntryCancel">Cancel</button>
    </div>
    <div id="entryMsg" class="small-muted" style="margin-top:10px"></div>
  </div>
</div>

<footer>Prototype ‚Äî ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô | Zones: ‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ, ‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£, ‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏≤‡∏ô‡∏µ, ‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà, ‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï</footer>

<script>
/* =======================
   Data model in localStorage
   keys:
     hub_config: {public_entry: true, site_password: '...', siteTitle, siteDesc}
     hub_tiles: [ {id, title, desc, iconBase64, url, order} ]
     hub_posts: [ {id, type, zone, name, content, imageBase64, status, createdAt, reactions: {üëçüèª:[],üëèüèª:[],...}} ]
     hub_admins: [ {user, passHash} ]  // for demo store simple password plaintext (NOT SECURE)
     hub_currentAdmin: {user, remember} // when logged in
     hub_userId: uuid per browser to limit reactions
   NOTE: This is demo only.
   ======================= */

const DEFAULTS = {
  config: { public_entry: true, site_password: 'hubdemo', siteTitle:'Link Hub ‚Äî ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏à', siteDesc:'‡∏£‡∏ß‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÅ‡∏•‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏ã‡∏ô‡∏ï‡πà‡∏≤‡∏á ‡πÜ' },
  zones: ['‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ','‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£','‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏≤‡∏ô‡∏µ','‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà','‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï'],
  reactionTypes: ['üëçüèª','üëèüèª','üôè','‚úåüèª','‚ù§Ô∏è','üî•','‚úÖ','üí∞']
};

function uid(prefix='id'){ return prefix + '_' + Math.random().toString(36).slice(2,9); }
function load(key, fallback){ try{ const v=localStorage.getItem(key); return v? JSON.parse(v): fallback }catch(e){return fallback}}
function save(key, val){ localStorage.setItem(key, JSON.stringify(val))}

// Initialize on first run
if(!load('hub_config')) save('hub_config', DEFAULTS.config)
if(!load('hub_tiles')) save('hub_tiles', [
  {id:uid('t'), title:'‡πÄ‡∏ß‡πá‡∏ö‡∏´‡∏•‡∏±‡∏Å', desc:'‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó', iconBase64:'', url:'https://example.com', order:1},
  {id:uid('t'), title:'Contact', desc:'‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤', iconBase64:'', url:'mailto:contact@example.com', order:2}
])
if(!load('hub_posts')) save('hub_posts', [])
if(!load('hub_admins')) save('hub_admins', [{user:'admin@example.com', pass:'admin123', role:'super'}])
if(!localStorage.getItem('hub_userId')) localStorage.setItem('hub_userId', uid('u'))

/* ====== Helpers & UI glue ====== */

const app = document.getElementById('app')
const landingHeader = document.getElementById('landingHeader')
const enterBtn = document.getElementById('enterBtn')
const entryModal = document.getElementById('entryModal')
const btnEntryOk = document.getElementById('btnEntryOk')
const btnEntryCancel = document.getElementById('btnEntryCancel')
const entryPassword = document.getElementById('entryPassword')
const entryMsg = document.getElementById('entryMsg')
const adminShortcut = document.getElementById('adminShortcut')
const adminLoginModal = document.getElementById('adminLoginModal')
const btnAdminLogin = document.getElementById('btnAdminLogin')
const btnAdminLoginCancel = document.getElementById('btnAdminLoginCancel')
const adminUser = document.getElementById('adminUser')
const adminPass = document.getElementById('adminPass')
const adminRemember = document.getElementById('adminRemember')
const adminLoginMsg = document.getElementById('adminLoginMsg')
const hubView = document.getElementById('hubView')
const adminView = document.getElementById('adminView')
const adminContent = document.getElementById('adminContent')
const navAdminLinks = document.getElementById('navAdminLinks')
const userInfo = document.getElementById('userInfo')
const logoutBtn = document.getElementById('logoutBtn')
const goLanding = document.getElementById('goLanding')
const hubName = document.getElementById('hubName')
const hubShort = document.getElementById('hubShort')
const tilesWrap = document.getElementById('tilesWrap')
const btnAddTile = document.getElementById('btnAddTile')
const feedList = document.getElementById('feedList')
const postType = document.getElementById('postType')
const postZone = document.getElementById('postZone')
const postName = document.getElementById('postName')
const postContent = document.getElementById('postContent')
const postImage = document.getElementById('postImage')
const postImagePreview = document.getElementById('postImagePreview')
const humanCheck = document.getElementById('humanCheck')
const btnPost = document.getElementById('btnPost')
const quickStats = document.getElementById('quickStats')
const pinnedLinks = document.getElementById('pinnedLinks')
const postComposer = document.getElementById('postComposer')
const siteTitleEl = document.getElementById('siteTitle')
const siteDescEl = document.getElementById('siteDesc')
const hubAvatar = document.getElementById('hubAvatar')

let config = load('hub_config')
let tiles = load('hub_tiles')
let posts = load('hub_posts')
let admins = load('hub_admins')
let currentAdmin = load('hub_currentAdmin') || null
const userId = localStorage.getItem('hub_userId')
const reactionTypes = DEFAULTS.reactionTypes

// Render initial
siteTitleEl.textContent = config.siteTitle
siteDescEl.textContent = config.siteDesc
hubName.textContent = config.siteTitle
hubShort.textContent = config.siteDesc
hubAvatar.textContent = config.siteTitle.split(' ').map(s=>s[0]).slice(0,2).join('').toUpperCase()

// Entry logic
enterBtn.addEventListener('click', () => {
  config = load('hub_config')
  if(config.public_entry) openHub()
  else {
    entryPassword.value=''
    entryMsg.textContent=''
    entryModal.classList.remove('hidden')
  }
})

btnEntryOk.addEventListener('click', ()=>{
  const v = entryPassword.value.trim()
  if(!v){ entryMsg.textContent='‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™' ; return }
  config = load('hub_config')
  if(v === config.site_password){ entryModal.classList.add('hidden'); openHub(); }
  else { entryMsg.textContent='‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á' }
})
btnEntryCancel.addEventListener('click', ()=> entryModal.classList.add('hidden'))

// Admin shortcut (visible if admin session present)
function updateAdminShortcut(){
  currentAdmin = load('hub_currentAdmin')
  if(currentAdmin && currentAdmin.user){
    adminShortcut.classList.remove('hidden')
    navAdminLinks.classList.remove('hidden')
    logoutBtn.classList.remove('hidden')
    userInfo.innerHTML = `<span class="small-muted">Admin: ${currentAdmin.user}</span>`
    adminShortcut.onclick = () => openAdmin('dashboard')
  } else {
    adminShortcut.classList.add('hidden')
    navAdminLinks.classList.add('hidden')
    logoutBtn.classList.add('hidden')
    userInfo.textContent = ''
  }
}
updateAdminShortcut()

// Admin login modal flow
adminShortcut.addEventListener('click', ()=> {
  if(load('hub_currentAdmin')) openAdmin('dashboard')
  else {
    adminLoginModal.classList.remove('hidden')
    adminLoginMsg.textContent=''
    adminUser.value=''; adminPass.value=''; adminRemember.checked=false
  }
})
btnAdminLoginCancel.addEventListener('click', ()=> adminLoginModal.classList.add('hidden'))

btnAdminLogin.addEventListener('click', ()=> {
  const u = adminUser.value.trim(), p = adminPass.value
  if(!u||!p){ adminLoginMsg.textContent='‡∏£‡∏∞‡∏ö‡∏∏ user & password'; return }
  admins = load('hub_admins')
  const found = admins.find(a=>a.user===u && a.pass===p)
  if(found){
    save('hub_currentAdmin', {user:u, remember: adminRemember.checked, role: found.role || 'moderator'})
    adminLoginMsg.textContent='login success'
    adminLoginModal.classList.add('hidden')
    updateAdminShortcut()
    openAdmin('dashboard')
  } else { adminLoginMsg.textContent='invalid credentials' }
})

// Logout
document.getElementById('adminLogout').addEventListener('click', ()=> {
  localStorage.removeItem('hub_currentAdmin')
  updateAdminShortcut()
  adminView.classList.add('hidden')
  hubView.classList.remove('hidden')
})
logoutBtn.addEventListener('click', ()=> {
  localStorage.removeItem('hub_currentAdmin')
  updateAdminShortcut()
  alert('Admin logged out on this device')
})

// Go back to landing
goLanding.addEventListener('click', ()=> {
  app.style.display='none'
  landingHeader.style.display='block'
})

// Open hub
function openHub(){
  landingHeader.style.display='none'
  app.style.display='block'
  renderTiles()
  renderFeed()
  renderQuickStats()
  renderPinned()
  updateAdminShortcut()
  // show admin nav if admin logged in
  if(load('hub_currentAdmin')) {
    document.getElementById('hubActions').innerHTML = '<button onclick="openAdmin(\'dashboard\')">Admin panel</button>'
  } else document.getElementById('hubActions').innerHTML = ''
}

// Tiles UI
function renderTiles(){
  tiles = load('hub_tiles')
  tilesWrap.innerHTML = ''
  tiles.sort((a,b)=> (a.order||0)-(b.order||0))
  tiles.forEach(t=>{
    const div = document.createElement('div'); div.className='tile card'
    const img = document.createElement('img'); img.src = t.iconBase64 || 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80"><rect width="100%" height="100%" fill="#eef"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#889" font-size="14">${(t.title||'')}</text></svg>`)
    const meta = document.createElement('div'); meta.className='meta'
    meta.innerHTML = `<strong>${t.title}</strong><small>${t.desc||''}</small>`
    const actions = document.createElement('div')
    actions.style.marginLeft='8px'
    if(load('hub_currentAdmin')) {
      const edit = document.createElement('button'); edit.textContent='Edit'; edit.style.background='#666'; edit.onclick = ()=> openTileEditor(t.id)
      const del = document.createElement('button'); del.textContent='Del'; del.style.background='#c33'; del.onclick = ()=> { if(confirm('Delete?')){ tiles = tiles.filter(x=>x.id!==t.id); save('hub_tiles',tiles); renderTiles(); } }
      actions.appendChild(edit); actions.appendChild(del)
    }
    div.appendChild(img); div.appendChild(meta); div.appendChild(actions)
    div.onclick = (e)=> {
      // open link only if clicked tile area, not admin buttons
      if(e.target.tagName.toLowerCase()==='button') return
      window.open(t.url, '_blank')
      // increment click stat
      t.clicks = (t.clicks||0)+1; save('hub_tiles', tiles)
      renderQuickStats()
    }
    tilesWrap.appendChild(div)
  })
  btnAddTile.classList.toggle('hidden', !load('hub_currentAdmin'))
}

// Tile editor (simple prompt-based)
function openTileEditor(id=null){
  const isNew = !id
  const t = isNew ? {id:uid('t'), title:'', desc:'', url:'', iconBase64:'', order: (tiles.length+1)} : tiles.find(x=>x.id===id)
  // build a small modal-like UI (quick)
  const wrap = document.createElement('div'); wrap.className='card'
  wrap.style.position='fixed'; wrap.style.left='50%'; wrap.style.top='50%'; wrap.style.transform='translate(-50%,-50%)'; wrap.style.zIndex=9999; wrap.style.width='420px'
  wrap.innerHTML = `
    <h3>${isNew?'Create Tile':'Edit Tile'}</h3>
    <label class="block">Title</label><input id="t_title" type="text" value="${t.title||''}">
    <label class="block">Desc (optional)</label><input id="t_desc" type="text" value="${t.desc||''}">
    <label class="block">URL</label><input id="t_url" type="text" value="${t.url||''}">
    <label class="block">Icon (image)</label><input id="t_icon" type="file" accept="image/*">
    <div style="display:flex; gap:8px; margin-top:8px"><button id="t_save">Save</button><button id="t_cancel">Cancel</button></div>
  `
  document.body.appendChild(wrap)
  const inpIcon = wrap.querySelector('#t_icon'), t_title = wrap.querySelector('#t_title'), t_desc = wrap.querySelector('#t_desc'), t_url = wrap.querySelector('#t_url')
  inpIcon.addEventListener('change', e=>{
    const f = e.target.files[0]; if(!f) return
    const r = new FileReader(); r.onload = ()=> t.iconBase64 = r.result; r.readAsDataURL(f)
  })
  wrap.querySelector('#t_cancel').onclick = ()=> document.body.removeChild(wrap)
  wrap.querySelector('#t_save').onclick = ()=>{
    t.title = t_title.value.trim()||'Untitled'
    t.desc = t_desc.value.trim()
    t.url = t_url.value.trim()||'#'
    if(isNew) tiles.push(t); save('hub_tiles', tiles); renderTiles(); document.body.removeChild(wrap)
  }
}

// Post composer
let lastPostTs = 0
postImage.addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) { postImagePreview.classList.add('hidden'); return }
  const r = new FileReader(); r.onload = ()=> { postImagePreview.src = r.result; postImagePreview.classList.remove('hidden'); postImagePreview.dataset.src = r.result; }
  r.readAsDataURL(f)
})
btnPost.addEventListener('click', ()=>{
  // basic validation + rate limit + captcha
  const type = postType.value, zone = postZone.value, name = postName.value.trim(), content = postContent.value.trim()
  if(!type||!zone||!name||!content){ alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'); return }
  if(!humanCheck.checked){ alert('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ö‡∏≠‡∏ó'); return }
  const now = Date.now()
  if(now - lastPostTs < 30*1000){ alert('Rate limit: ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ'); return }
  lastPostTs = now
  const img = postImagePreview.dataset.src || ''
  const p = { id: uid('p'), type, zone, name, content, imageBase64: img, status: (load('hub_config').auto_publish? 'published' : 'pending'), createdAt: now, reactions: {} }
  reactionTypes.forEach(r=> p.reactions[r]=[])
  posts = load('hub_posts')
  posts.unshift(p)
  save('hub_posts', posts)
  // reset
  postName.value=''; postContent.value=''; postImage.value=''; postImagePreview.classList.add('hidden'); humanCheck.checked=false
  renderFeed()
  renderQuickStats()
  alert('‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢' + (p.status==='pending'?' (‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)':''))
})

// Render feed
function renderFeed(){
  posts = load('hub_posts')
  feedList.innerHTML = ''
  posts.forEach(post=>{
    if(post.status === 'removed') return
    // visitors see only published
    if(!isAdmin() && post.status !== 'published') return
    const box = document.createElement('div'); box.className='post card'
    const header = document.createElement('div'); header.className='post-header'
    header.innerHTML = `<div style="width:44px;height:44px;border-radius:50%;background:#eef;display:flex;align-items:center;justify-content:center">${post.name[0]||'U'}</div>
      <div style="flex:1"><strong>${post.name}</strong> <div class="small-muted zone-tag">${post.type} ‚Ä¢ ${post.zone}</div></div>
      <div class="small-muted">${new Date(post.createdAt).toLocaleString()}</div>`
    const body = document.createElement('div'); body.className='post-body'
    body.innerHTML = `<div style="white-space:pre-wrap">${escapeHtml(post.content)}</div>`
    if(post.imageBase64){ const im = document.createElement('img'); im.src = post.imageBase64; im.className='image-preview'; body.appendChild(im) }
    // reactions
    const reCont = document.createElement('div'); reCont.className='reactions'
    reactionTypes.forEach(r=>{
      const btn = document.createElement('button'); btn.className='reaction-btn'; btn.textContent = r + ' ' + (post.reactions[r]?.length||0)
      btn.onclick = ()=> toggleReaction(post.id, r)
      reCont.appendChild(btn)
    })
    // admin actions
    const adminActions = document.createElement('div'); adminActions.style.marginTop='8px'
    if(isAdmin()){
      const approve = document.createElement('button'); approve.textContent = post.status==='published'?'Hide':'Publish'; approve.style.background='#0a8'; approve.onclick = ()=> { post.status = post.status==='published'?'hidden':'published'; saveStatus(post.id, post.status); renderFeed(); }
      const edit = document.createElement('button'); edit.textContent='Edit'; edit.style.background='#666'; edit.onclick = ()=> openPostEditor(post.id)
      const del = document.createElement('button'); del.textContent='Remove'; del.style.background='#c33'; del.onclick = ()=> { if(confirm('Remove permanently?')){ setPostStatus(post.id,'removed'); renderFeed(); } }
      adminActions.appendChild(approve); adminActions.appendChild(edit); adminActions.appendChild(del)
      // show status
      const st = document.createElement('div'); st.className='small-muted'; st.textContent = 'Status: ' + post.status; adminActions.appendChild(st)
    }
    box.appendChild(header); box.appendChild(body); box.appendChild(reCont); box.appendChild(adminActions)
    feedList.appendChild(box)
  })
}

// Reaction logic: each user can react once per reaction type; allow multiple different reactions
function toggleReaction(postId, reaction){
  posts = load('hub_posts')
  const p = posts.find(x=>x.id===postId); if(!p) return
  const list = p.reactions[reaction] || []
  const idx = list.indexOf(userId)
  if(idx===-1) list.push(userId) // add
  else list.splice(idx,1) // remove
  p.reactions[reaction]=list
  save('hub_posts', posts)
  renderFeed()
  renderQuickStats()
}

// Admin helpers
function isAdmin(){ return !!load('hub_currentAdmin') }
window.openAdmin = function(route='dashboard'){
  // show admin view
  hubView.classList.add('hidden')
  adminView.classList.remove('hidden')
  adminContent.innerHTML = ''
  renderAdminRoute(route)
}

function renderAdminRoute(route){
  adminContent.innerHTML = ''
  if(route==='dashboard') {
    adminContent.innerHTML = '<h3>Admin Dashboard</h3><div id="dashStats"></div><div style="margin-top:12px"><button id="quickMenus">Manage Menus</button> <button id="quickPosts">Moderate Posts</button></div>'
    document.getElementById('quickMenus').onclick = ()=> renderAdminRoute('menus')
    document.getElementById('quickPosts').onclick = ()=> renderAdminRoute('posts')
    const ds = document.getElementById('dashStats'); ds.innerHTML = ''
    const postsData = load('hub_posts') || []
    const total = postsData.length
    const pending = postsData.filter(p=>p.status==='pending').length
    const published = postsData.filter(p=>p.status==='published').length
    const hidden = postsData.filter(p=>p.status==='hidden').length
    ds.innerHTML = `<div class="list"><div>Total posts: ${total}</div><div>Published: ${published}</div><div>Pending: ${pending}</div><div>Hidden: ${hidden}</div></div>`
    return
  }
  if(route==='menus'){
    adminContent.innerHTML = '<h3>Manage Tiles / Menus</h3><div id="menusList"></div><div style="margin-top:8px"><button id="createTile">Create Tile</button></div>'
    const ml = document.getElementById('menusList'); ml.innerHTML=''
    tiles = load('hub_tiles')
    tiles.forEach(t=>{
      const r = document.createElement('div'); r.className='card'; r.style.display='flex'; r.style.justifyContent='space-between'; r.style.alignItems='center'; r.style.marginTop='8px'
      r.innerHTML = `<div><strong>${t.title}</strong><div class="small-muted">${t.url}</div></div>`
      const controls = document.createElement('div')
      const up = document.createElement('button'); up.textContent='Up'; up.onclick = ()=> { t.order = (t.order||0)-1; save('hub_tiles', tiles); renderAdminRoute('menus'); renderTiles(); }
      const down = document.createElement('button'); down.textContent='Down'; down.onclick = ()=> { t.order = (t.order||0)+1; save('hub_tiles', tiles); renderAdminRoute('menus'); renderTiles(); }
      const edit = document.createElement('button'); edit.textContent='Edit'; edit.onclick = ()=> openTileEditor(t.id)
      const del = document.createElement('button'); del.textContent='Delete'; del.onclick = ()=> { if(confirm('Delete?')){ tiles = tiles.filter(x=>x.id!==t.id); save('hub_tiles', tiles); renderAdminRoute('menus'); renderTiles(); } }
      controls.appendChild(up); controls.appendChild(down); controls.appendChild(edit); controls.appendChild(del)
      r.appendChild(controls); ml.appendChild(r)
    })
    document.getElementById('createTile').onclick = ()=> openTileEditor(null)
    return
  }
  if(route==='posts'){
    posts = load('hub_posts') || []
    adminContent.innerHTML = '<h3>Moderation Queue</h3><div id="modList"></div>'
    const ml = document.getElementById('modList')
    posts.forEach(p=>{
      const r = document.createElement('div'); r.className='card'; r.style.marginTop='8px'
      r.innerHTML = `<div><strong>${p.name}</strong> <span class="small-muted">[${p.type} ‚Ä¢ ${p.zone}]</span><div class="small-muted">${new Date(p.createdAt).toLocaleString()}</div><div style="margin-top:8px">${escapeHtml(p.content)}</div></div>`
      const controls = document.createElement('div'); controls.style.marginTop='8px'
      const approve = document.createElement('button'); approve.textContent='Publish'; approve.onclick = ()=>{ setPostStatus(p.id,'published'); renderAdminRoute('posts'); renderFeed(); renderQuickStats(); }
      const hide = document.createElement('button'); hide.textContent='Hide'; hide.onclick = ()=>{ setPostStatus(p.id,'hidden'); renderAdminRoute('posts'); renderFeed(); }
      const edit = document.createElement('button'); edit.textContent='Edit'; edit.onclick = ()=> openPostEditor(p.id)
      const remove = document.createElement('button'); remove.textContent='Remove'; remove.onclick = ()=>{ if(confirm('Remove permanently?')){ setPostStatus(p.id,'removed'); renderAdminRoute('posts'); renderFeed(); } }
      controls.appendChild(approve); controls.appendChild(hide); controls.appendChild(edit); controls.appendChild(remove)
      r.appendChild(controls)
      ml.appendChild(r)
    })
    return
  }
  if(route==='settings'){
    adminContent.innerHTML = `<h3>Settings</h3>
      <label class="block">Site Title</label><input id="s_title" value="${config.siteTitle}">
      <label class="block">Site Description</label><input id="s_desc" value="${config.siteDesc}">
      <label class="block">Access Mode</label>
      <label><input id="s_public" type="checkbox"> Public entry (if unchecked ‚Üí protected)</label>
      <label class="block">Site-wide password (for Protected)</label><input id="s_password" type="text" value="${config.site_password}">
      <label style="margin-top:8px"><input id="s_auto_pub" type="checkbox"> Auto-publish posts (no moderation)</label>
      <div style="margin-top:12px"><button id="s_save">Save Settings</button></div>`
    document.getElementById('s_public').checked = config.public_entry
    document.getElementById('s_auto_pub').checked = config.auto_publish || false
    document.getElementById('s_save').onclick = ()=>{
      config.siteTitle = document.getElementById('s_title').value
      config.siteDesc = document.getElementById('s_desc').value
      config.public_entry = document.getElementById('s_public').checked
      config.site_password = document.getElementById('s_password').value || config.site_password
      config.auto_publish = document.getElementById('s_auto_pub').checked
      save('hub_config', config)
      siteTitleEl.textContent = config.siteTitle; siteDescEl.textContent = config.siteDesc; hubName.textContent = config.siteTitle; hubShort.textContent = config.siteDesc
      alert('Saved settings')
    }
    return
  }
  if(route==='media'){
    adminContent.innerHTML = `<h3>Media</h3><div class="small-muted">Upload cover/avatar images (saved to localStorage)</div>
      <label class="block">Upload Cover (preview only)</label><input id="m_cover" type="file" accept="image/*">
      <label class="block">Upload Avatar</label><input id="m_avatar" type="file" accept="image/*">
      <div style="margin-top:8px"><button id="m_save">Apply</button></div>`
    document.getElementById('m_save').onclick = ()=>{
      const c = document.getElementById('m_cover').files[0], a = document.getElementById('m_avatar').files[0]
      if(c){
        const r = new FileReader(); r.onload = ()=> { config.cover = r.result; save('hub_config', config); landingHeader.style.backgroundImage = `url(${r.result})`; alert('Cover applied') }; r.readAsDataURL(c)
      }
      if(a){
        const r2 = new FileReader(); r2.onload = ()=> { config.avatar = r2.result; save('hub_config', config); hubAvatar.style.backgroundImage = `url(${r2.result})`; hubAvatar.textContent=''; alert('Avatar applied') }; r2.readAsDataURL(a)
      }
    }
    return
  }
  adminContent.innerHTML = '<div>Route not found</div>'
}

// Post editor
function openPostEditor(id){
  const p = load('hub_posts').find(x=>x.id===id); if(!p) return
  const wrap = document.createElement('div'); wrap.className='card'; wrap.style.position='fixed'; wrap.style.left='50%'; wrap.style.top='50%'; wrap.style.transform='translate(-50%,-50%)'; wrap.style.zIndex=9999; wrap.style.width='500px'
  wrap.innerHTML = `<h3>Edit Post</h3>
    <label class="block">Name</label><input id="ep_name" value="${p.name}">
    <label class="block">Content</label><textarea id="ep_content">${escapeHtml(p.content)}</textarea>
    <label class="block">Status</label><select id="ep_status"><option value="pending">pending</option><option value="published">published</option><option value="hidden">hidden</option></select>
    <div style="margin-top:8px"><button id="ep_save">Save</button> <button id="ep_cancel">Cancel</button></div>`
  document.body.appendChild(wrap)
  document.getElementById('ep_status').value = p.status
  wrap.querySelector('#ep_cancel').onclick = ()=> document.body.removeChild(wrap)
  wrap.querySelector('#ep_save').onclick = ()=>{
    p.name = document.getElementById('ep_name').value
    p.content = document.getElementById('ep_content').value
    p.status = document.getElementById('ep_status').value
    const all = load('hub_posts').map(x=> x.id===p.id? p: x)
    save('hub_posts', all)
    document.body.removeChild(wrap)
    renderFeed(); renderQuickStats(); renderAdminRoute('posts')
  }
}

// Utilities
function setPostStatus(id, status){
  posts = load('hub_posts').map(p=> p.id===id? {...p, status}:p)
  save('hub_posts', posts)
}
function saveStatus(id, status){
  posts = load('hub_posts')
  const p = posts.find(x=>x.id===id)
  if(p){ p.status = status; save('hub_posts', posts) }
  renderFeed()
}
function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;') }

// Stats
function renderQuickStats(){
  posts = load('hub_posts') || []
  const total = posts.length
  const published = posts.filter(p=>p.status==='published').length
  const pending = posts.filter(p=>p.status==='pending').length
  quickStats.innerHTML = `<div>Total posts: ${total}</div><div>Published: ${published}</div><div>Pending: ${pending}</div>`
  // top tiles by clicks
  tiles = load('hub_tiles') || []
  pinnedLinks.innerHTML = ''
  tiles.slice(0,4).forEach(t=>{
    const a = document.createElement('a'); a.href=t.url; a.target='_blank'; a.textContent = t.title; a.className='small-muted'; a.style.display='block'; pinnedLinks.appendChild(a)
  })
}

// Initial open if public_entry true? nope wait for enter
// Admin nav buttons
document.querySelectorAll('.admin-route').forEach(b=> b.addEventListener('click', (e)=> renderAdminRoute(e.target.dataset.adminRoute)))

// Small helpers
document.getElementById('btnAddTile').addEventListener('click', ()=> openTileEditor(null))

// On load show landing
landingHeader.style.display='block'
app.style.display='none'
updateAdminShortcut()
renderQuickStats()

// simple helper to show admin login if URL has #admin
if(location.hash === '#admin-login'){ adminLoginModal.classList.remove('hidden') }
</script>
</body>
</html>
